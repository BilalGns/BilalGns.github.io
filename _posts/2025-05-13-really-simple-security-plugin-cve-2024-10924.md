---
title: "CVE: Really Simple Security CVE-2024-10924"
author: b1lal
categories: [CVE, "2024"]
tags: [cve, cve 2024-10924, 2fa, wordpress, cms, plugin, wordpress plugin]
render_with_liquid: false
description: "Really Simple Security eklentisinde bulunan CVE-2024-10924 zafiyetini analiz edeceğiz ve nasıl sömürebileceğimizi öğreneceğiz."
media_subpath: /images/really_simple_security_plugin_cve-2024-10924/
layout: post
published: false  
lang: "tr"
image:
  path: main.png
  alt: "Really Simple Security CVE-2024-10924"
---

WordPress, açık kaynak kodlu en popüler içerik yönetim sistemlerinden (CMS) birisidir. Bloglardan e-ticaret sitelerine kadar birçok web projesinde yaygın olarak kullanılmaktadır. Kasım 2024’te, milyonlarca site tarafından kullanılan **Really Simple Security** adlı popüler bir güvenlik eklentisinde kritik bir güvenlik açığı keşfedildi. Bu açık, saldırganların kimlik doğrulamasını atlayarak kullanıcı hesaplarına, hatta yönetici yetkisine sahip hesaplara yetkisiz erişim sağlamasına olanak tanıyordu. Bu zafiyet, <a href="https://www.wordfence.com/threat-intel/vulnerabilities/detail/really-simple-security-free-pro-and-pro-multisite-900-9111-authentication-bypass" target="_blank">Wordfence</a>'ten **István Márton** tarafından keşfedildi ve CVSS skoru <b style="color: red;">9.8</b> olarak derecelendirilip `CVE-2024-10924` numarasıyla kayıtlara geçti.


## Zafiyet Nasıl Çalışıyor?

Sorunun temelinde, **REST API** uç noktalarının işlenmesinde güvenli kodlama standartlarına uyulmaması yatıyor.

Eklenti, **İki Faktörlü Kimlik Doğrulama (2FA)** gibi ekstra güvenlik katmanları sunmayı amaçlasa da, kimlik doğrulama sürecindeki önemli bir doğrulama eksikliği, saldırganların bu mekanizmayı atlatmasına olanak tanıyor. Özellikle API üzerinden gönderilen parametrelerin yeterince filtrelenmemesi ve kontrollerin gevşek tutulması, saldırganların sistemde doğrulanmış gibi görünmesini sağlıyor.

<br>

<p style="font-size: 18px; font-weight:bold">WordPress Giriş Noktaları</p>

- **Admin Paneli:** `/wp-admin` üzerinden erişilir. Sadece kimliği doğrulanmış kullanıcılar ulaşabilir.

- **Herkese Açık Arayüz:** Ana dizindeki **index.php** tarafından yönetilir, ziyaretçilere içerik sunar.

- **REST API:** Geliştiricilerin site verilerini yönetmesine olanak tanır. Hassas verilere erişim için düzgün kimlik doğrulama şarttır.

**CVE-2024-10924**, eklentinin 2FA sistemine entegre edilen REST API uç noktalarını hedef alıyor. Saldırganlar, API çağrılarında kullanılan parametreleri manipüle ederek kimlik doğrulamayı geçebiliyor. Bu zafiyet, özellikle **skip_onboarding** özelliğinde kullanıcıdan gelen verilerin yeterince doğrulanmamasından kaynaklanıyor.

<br>

## Detaylı Teknik Açıklaması

Zafiyetin merkezinde, eklentideki <a href="https://plugintests.com/plugins/wporg/really-simple-ssl/9.3.1/structure/classes/RSSSL/Security/WordPress/Two_Fa/Rsssl_Two_Factor_On_Board_Api" target="_blank">Rsssl_Two_Factor_On_Board_Api</a> adlı PHP sınıfı bulunuyor. Bu sınıf, kimlik doğrulama sürecini yöneten birkaç önemli fonksiyonu içeriyor:

![Mekanizma](rsc.svg)

1. <b style="color: white; font-size: 16px">skip_onboarding:</b> Bu fonksiyon, 2FA onboarding sürecini atlamayı sağlıyor. Gelen `user_id`, `login_nonce` ve `redirect_to` parametrelerini alıyor, ardından `check_login_and_get_user` fonksiyonuna gönderiyor. Buradan dönen kullanıcı nesnesiyle birlikte `authenticate_and_redirect` fonksiyonu çağrılarak kullanıcı, belirtilen URL’ye yönlendiriliyor.  

```php
/**
* Skips the onboarding process for the user.
*
* @param WP_REST_Request $request The REST request object.
*
* @return WP_REST_Response The REST response object.
*/
public function skip_onboarding( WP_REST_Request $request ): WP_REST_Response {
$parameters = new Rsssl_Request_Parameters( $request );
// As a double we check the user_id with the login nonce.
$user = $this->check_login_and_get_user( (int)$parameters->user_id, $parameters->login_nonce );
return $this->authenticate_and_redirect( $parameters->user_id, $parameters->redirect_to );
```

<br>

Ancak sorun şu ki: `check_login_and_get_user` fonksiyonu geçersiz bir nonce durumunda null döndüğünde bile, `skip_onboarding` fonksiyonu bunu kontrol etmiyor. Bu da saldırgana, geçersiz kimlik bilgileriyle bile yönlendirme ve dolayısıyla yetkisiz erişim hakkı kazandırıyor. <br><br> Bu API çağrısı şu uç noktadan yapılmaktadır: `/?rest_route=/reallysimplessl/v1/two_fa/skip_onboarding` **POST** metodu ile gönderilen parametreler ise bunlardır: `user_id`, `login_nonce`, `redirect_to` <br><br>

2. <b style="color: white; font-size: 16px">check_login_and_get_user:</b> Bu fonksiyon, gönderilen `user_id` ve `login_nonce` değerlerinin geçerliliğini kontrol ediyor. Eğer `login_nonce` doğrulanamazsa, **403** hata koduyla bir `WP_REST_Response` döndürüyor. Aksi takdirde, ilgili kullanıcı nesnesi döndürülüyor. <br> Büyük sorun ise, **skip_onboarding** fonksiyonu bu kontrol sonucunu hiç dikkate almamasıdır.<br>

```php
/**
* Verifies a login nonce, gets user by the user id, and returns an error response if any steps fail.
*
* @param int    $user_id The user ID.
* @param string $login_nonce The login nonce.
*
* @return WP_User|WP_REST_Response
*/

private function check_login_and_get_user( int $user_id, string $login_nonce ) {
	if ( ! Rsssl_Two_Fa_Authentication::verify_login_nonce( $user_id, $login_nonce ) ) {
		return new WP_REST_Response( array( 'error' => 'Invalid login nonce' ), 403 );
	}
```

<br>

3. <b style="color: white; font-size: 16px">authenticate_and_redirect:</b> Bu fonksiyon, kullanıcıyı doğrulanmış varsayıp, `user_id` ve `redirect_to` parametrelerini kullanarak kullanıcıyı yönlendiriyor. `wp_set_auth_cookie` fonksiyonu ile kullanıcıya oturum çerezi atanıyor ve işlem tamamlanıyor. <br> <span style="color: #e74c3c; font-weight: bold;">Dikkat!</span> Burada kritik bir hata var: Bu işlem öncesinde gelen kullanıcının gerçekten doğrulanıp doğrulanmadığı hiç kontrol edilmiyor. Dolayısıyla, saldırgan direkt olarak oturum açmış gibi davranabiliyor.

```php
/**
* Sets the authentication cookie and returns a success response.
*
* @param int    $user_id The user ID.
* @param string $redirect_to The redirect URL.
*
* @return WP_REST_Response
*/
	 
private function authenticate_and_redirect( int $user_id, string $redirect_to = '' ): WP_REST_Response {
	// Okay checked the provider now authenticate the user.
	wp_set_auth_cookie( $user_id, true );
	// Finally redirect the user to the redirect_to page or to the home page if the redirect_to is not set.
	$redirect_to = $redirect_to ?: home_url();
	return new WP_REST_Response( array( 'redirect_to' => $redirect_to ), 200 );
}
```

<br>

Şimdi bu maddelerin hepsini birleştirerek toparlayacak olursak: Bu güvenlik açığı, sadece 2FA aktif edilmiş kullanıcı hesaplarında işe yarıyor. Zincirleme yöntem akışı şu şekilde işliyor:

- **skip_onboarding:** `check_login_and_get_user` fonksiyonundan dönen değeri kontrol etmiyor.

- **check_login_and_get_user:** Geçersiz kimlik bilgilerini doğru şekilde tespit ediyor ama sonucu işleyene güveniyor (ama o işlemiyor).


- **authenticate_and_redirect:** Körü körüne kullanıcıyı oturum açmış gibi kabul ediyor ve yönlendiriyor.


Sonuç olarak , saldırganlar bu API uç noktasını kullanarak, geçersiz kimlik bilgileriyle bile yönetici yetkisine sahip hesaplara erişebiliyor. Bu da, eklentinin güvenlik iddiasıyla çelişiyor ve ciddi bir güvenlik açığına yol açıyor.

<style>
.center img {
  display:block;
  margin-left:auto;
  margin-right:auto;
}
.wrap pre{
  white-space: pre-wrap;
}

/* body,  h2, h3, h4, h5, h6, p, ul, ol, li, pre, code {
  font-family: 'Open Sans', sans-serif;
} */

.post-desc {
  font-family: 'Open Sans', sans-serif !important;
}

</style>
